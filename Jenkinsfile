pipeline {
  agent any
  stages {
    stage('create database') {
      steps {
        openshiftCreateResource(namespace: 'ferry', jsonyaml: 'apiVersion: apps.openshift.io/v1 kind: DeploymentConfig metadata:   annotations:     template.alpha.openshift.io/wait-for-ready: \'true\'   creationTimestamp: \'2018-03-24T09:22:26Z\'   generation: 2   labels:     template: mariadb-persistent-template   name: mariadb   namespace: ferry   ownerReferences:     - apiVersion: template.openshift.io/v1       blockOwnerDeletion: true       kind: TemplateInstance       name: dae45fc1-a467-4515-ace6-ecad8f3b1b09       uid: de037fe6-2f44-11e8-83dc-0ac0aacb8584   resourceVersion: \'3485137\'   selfLink: /apis/apps.openshift.io/v1/namespaces/ferry/deploymentconfigs/mariadb   uid: de0a0991-2f44-11e8-83dc-0ac0aacb8584 spec:   replicas: 1   selector:     name: mariadb   strategy:     activeDeadlineSeconds: 21600     recreateParams:       timeoutSeconds: 600     resources: {}     type: Recreate   template:     metadata:       creationTimestamp: null       labels:         name: mariadb     spec:       containers:         - env:             - name: MYSQL_USER               valueFrom:                 secretKeyRef:                   key: database-user                   name: mariadb             - name: MYSQL_PASSWORD               valueFrom:                 secretKeyRef:                   key: database-password                   name: mariadb             - name: MYSQL_ROOT_PASSWORD               valueFrom:                 secretKeyRef:                   key: database-root-password                   name: mariadb             - name: MYSQL_DATABASE               valueFrom:                 secretKeyRef:                   key: database-name                   name: mariadb           image: >-             registry.access.redhat.com/rhscl/mariadb-101-rhel7@sha256:4b9189927565d6bc8eba3af56793525636e7156b8f9dac54630b832df8e4b925           imagePullPolicy: IfNotPresent           livenessProbe:             failureThreshold: 3             initialDelaySeconds: 30             periodSeconds: 10             successThreshold: 1             tcpSocket:               port: 3306             timeoutSeconds: 1           name: mariadb           ports:             - containerPort: 3306               protocol: TCP           readinessProbe:             exec:               command:                 - /bin/sh                 - \'-i\'                 - \'-c\'                 - >-                   MYSQL_PWD="$MYSQL_PASSWORD" mysql -h 127.0.0.1 -u $MYSQL_USER                   -D $MYSQL_DATABASE -e \'SELECT 1\'             failureThreshold: 3             initialDelaySeconds: 5             periodSeconds: 10             successThreshold: 1             timeoutSeconds: 1           resources:             limits:               memory: 512Mi           terminationMessagePath: /dev/termination-log           terminationMessagePolicy: File           volumeMounts:             - mountPath: /var/lib/mysql/data               name: mariadb-data       dnsPolicy: ClusterFirst       restartPolicy: Always       schedulerName: default-scheduler       securityContext: {}       terminationGracePeriodSeconds: 30       volumes:         - emptyDir: {}           name: mariadb-data   test: false   triggers:     - imageChangeParams:         automatic: true         containerNames:           - mariadb         from:           kind: ImageStreamTag           name: \'mariadb:10.1\'           namespace: openshift         lastTriggeredImage: >-           registry.access.redhat.com/rhscl/mariadb-101-rhel7@sha256:4b9189927565d6bc8eba3af56793525636e7156b8f9dac54630b832df8e4b925       type: ImageChange     - type: ConfigChange status:   availableReplicas: 0   conditions:     - lastTransitionTime: \'2018-03-24T09:22:26Z\'       lastUpdateTime: \'2018-03-24T09:22:26Z\'       message: Deployment config does not have minimum availability.       status: \'False\'       type: Available     - lastTransitionTime: \'2018-03-24T09:22:26Z\'       lastUpdateTime: \'2018-03-24T09:22:26Z\'       message: >-         replication controller "mariadb-1" is waiting for pod "mariadb-1-deploy"         to run       status: Unknown       type: Progressing   details:     causes:       - type: ConfigChange     message: config change   latestVersion: 1   observedGeneration: 2   replicas: 1   unavailableReplicas: 1   updatedReplicas: 1', apiURL: 'https://openshift-master.nosopenshifttest.os.nos.aws.npocloud.nl:8443', authToken: 'itT5u4nkWW9E6ED-6OlgKe12b9Yg482ACYqPY2chjP0')
      }
    }
  }
}